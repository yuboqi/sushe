{
    "sourceFile": "src/components/user/users.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1656584045539,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1656584052134,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,9 +77,9 @@\n           </el-form-item>\n           <el-form-item label=\"角色\" prop=\"role\">\n             <el-select v-model=\"addForm.role\" placeholder=\"请选择角色\">\n               <el-option label=\"超级管理员\" value=\"0\"></el-option>\n-              <el-option label=\"普通\" value=\"1\"></el-option>\n+              <el-option label=\"普通用户\" value=\"1\"></el-option>\n             </el-select>\n           </el-form-item>\n         </el-form>\n         <!-- 底部按钮区 -->\n"
                },
                {
                    "date": 1656584059762,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -105,9 +105,9 @@\n           </el-form-item>\n           <el-form-item label=\"角色\" prop=\"\">\n             <el-select v-model=\"editForm.roler\" placeholder=\"请选择角色\">\n               <el-option label=\"超级管理员\" value=\"0\"></el-option>\n-              <el-option label=\"普通管理员\" value=\"1\"></el-option>\n+              <el-option label=\"普通用户\" value=\"1\"></el-option>\n             </el-select>\n           </el-form-item>\n         </el-form>\n         <span slot=\"footer\" class=\"dialog-footer\">\n"
                },
                {
                    "date": 1656584067718,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -200,9 +200,9 @@\n   },\n   methods: {\n     // 格式化 table 表格数据\n     formatRole(row){\n-      return row.roler=='0'?'超级管理员':'普通管理员'\n+      return row.roler=='0'?'超级管理员':'普通用户'\n     },\n     // 封装页面加载请求函数\n     oneQuest() {\n       var _this = this;\n"
                },
                {
                    "date": 1656584096881,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -200,9 +200,9 @@\n   },\n   methods: {\n     // 格式化 table 表格数据\n     formatRole(row){\n-      return row.roler=='0'?'超级管理员':'普通用户'\n+      return row.roler=='0'?'管理员':'普通用户'\n     },\n     // 封装页面加载请求函数\n     oneQuest() {\n       var _this = this;\n"
                },
                {
                    "date": 1656584102782,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -76,9 +76,9 @@\n             <el-input v-model=\"addForm.telephone\"></el-input>\n           </el-form-item>\n           <el-form-item label=\"角色\" prop=\"role\">\n             <el-select v-model=\"addForm.role\" placeholder=\"请选择角色\">\n-              <el-option label=\"超级管理员\" value=\"0\"></el-option>\n+              <el-option label=\"管理员\" value=\"0\"></el-option>\n               <el-option label=\"普通用户\" value=\"1\"></el-option>\n             </el-select>\n           </el-form-item>\n         </el-form>\n@@ -104,9 +104,9 @@\n             <el-input v-model=\"editForm.tel\" clearable></el-input>\n           </el-form-item>\n           <el-form-item label=\"角色\" prop=\"\">\n             <el-select v-model=\"editForm.roler\" placeholder=\"请选择角色\">\n-              <el-option label=\"超级管理员\" value=\"0\"></el-option>\n+              <el-option label=\"管理员\" value=\"0\"></el-option>\n               <el-option label=\"普通用户\" value=\"1\"></el-option>\n             </el-select>\n           </el-form-item>\n         </el-form>\n"
                }
            ],
            "date": 1656584045539,
            "name": "Commit-0",
            "content": "<template>\n  <div>\n    <!-- 面包屑导航区 -->\n    <el-breadcrumb separator-class=\"el-icon-arrow-right\">\n      <el-breadcrumb-item :to=\"{ path: '/home' }\">首页</el-breadcrumb-item>\n      <el-breadcrumb-item>用户权限管理</el-breadcrumb-item>\n      <el-breadcrumb-item>用户权限列表</el-breadcrumb-item>\n    </el-breadcrumb>\n    <!-- 卡片视图区 -->\n    <el-card>\n      <!-- 搜索添加区域 -->\n      <el-row :gutter=\"30\">\n        <el-col :span=\"8\">\n          <el-input placeholder=\"请输入姓名\" v-model=\"queryInfo.query\" clearable>\n            <el-button slot=\"append\" icon=\"el-icon-search\" @click=\"search(queryInfo.query)\"></el-button>\n          </el-input>\n        </el-col>\n        <el-col :span=\"4\">\n          <el-button type=\"primary\" @click=\"addDialogVisible=true\">添加用户</el-button>\n        </el-col>\n      </el-row>\n      <!-- 表格数据区域 -->\n      <el-table :data=\"userlist\" stripe border height=\"420\">\n        <el-table-column type=\"index\"></el-table-column>\n        <el-table-column label=\"姓名\" prop=\"name\"></el-table-column>\n        <el-table-column label=\"性别\" prop=\"sex\"></el-table-column>\n        <el-table-column label=\"联系电话\" prop=\"tel\"></el-table-column>\n        <el-table-column label=\"角色\" prop='roler' :formatter=\"formatRole\"></el-table-column>\n        <el-table-column label=\"操作\" id=\"cz\">\n          <template slot-scope=\"scope\">\n            <!-- 修改按钮 -->\n            <el-tooltip effect=\"dark\" content=\"修改\" placement=\"top\" :enterable=\"false\">\n              <el-button\n                type=\"primary\"\n                icon=\"el-icon-edit\"\n                size=\"mini\"\n                @click=\"showEditDialog(scope.row)\"\n              ></el-button>\n            </el-tooltip>\n            <!-- 删除按钮 -->\n            <el-tooltip effect=\"dark\" content=\"删除\" placement=\"top\" :enterable=\"false\">\n              <el-button\n                type=\"danger\"\n                icon=\"el-icon-delete\"\n                size=\"mini\"\n                @click=\"removeUserById(scope.row.id)\"\n              ></el-button>\n            </el-tooltip>\n          </template>\n        </el-table-column>\n      </el-table>\n      <!-- 分页区域 -->\n      <el-pagination\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"queryInfo.pagenum\"\n        :page-sizes=\"[1, 2, 5, 7,10]\"\n        :page-size=\"queryInfo.pagesize\"\n        layout=\"total, sizes, prev, pager, next, jumper\"\n        :total=\"total\"\n      ></el-pagination>\n      <!-- 添加用户的对话框 -->\n      <el-dialog title=\"添加用户\" :visible.sync=\"addDialogVisible\" width=\"50%\" @close=\"addDialogClosed\">\n        <!-- 内容主体区 -->\n        <el-form :model=\"addForm\" :rules=\"addFormRules\" ref=\"addFormRef\" label-width=\"80px\">\n          <el-form-item label=\"姓名\" prop=\"userName\">\n            <el-input v-model=\"addForm.userName\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"性别\" prop=\"sex\">\n            <el-select v-model=\"addForm.sex\" placeholder=\"请选择性别\">\n              <el-option label=\"男\" value=\"男\"></el-option>\n              <el-option label=\"女\" value=\"女\"></el-option>\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"联系电话\" prop=\"telephone\">\n            <el-input v-model=\"addForm.telephone\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"角色\" prop=\"role\">\n            <el-select v-model=\"addForm.role\" placeholder=\"请选择角色\">\n              <el-option label=\"超级管理员\" value=\"0\"></el-option>\n              <el-option label=\"普通\" value=\"1\"></el-option>\n            </el-select>\n          </el-form-item>\n        </el-form>\n        <!-- 底部按钮区 -->\n        <span slot=\"footer\" class=\"dialog-footer\">\n          <el-button @click=\"addDialogVisible = false\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"addUser\">确 定</el-button>\n        </span>\n      </el-dialog>\n      <!-- 修改用户信息的对话框 -->\n      <el-dialog\n        title=\"修改用户\"\n        :visible.sync=\"editdialogVisible\"\n        width=\"50%\"\n        @close=\"editDialogClosed\"\n      >\n        <!-- 内容主体 -->\n        <el-form :model=\"editForm\" :rules=\"editFormRules\" ref=\"editFormRef\" label-width=\"80px\">\n          <el-form-item label=\"姓名\" prop=\"\">\n            <el-input v-model=\"editForm.name\" disabled></el-input>\n          </el-form-item>\n          <el-form-item label=\"联系电话\" prop=\"\">\n            <el-input v-model=\"editForm.tel\" clearable></el-input>\n          </el-form-item>\n          <el-form-item label=\"角色\" prop=\"\">\n            <el-select v-model=\"editForm.roler\" placeholder=\"请选择角色\">\n              <el-option label=\"超级管理员\" value=\"0\"></el-option>\n              <el-option label=\"普通管理员\" value=\"1\"></el-option>\n            </el-select>\n          </el-form-item>\n        </el-form>\n        <span slot=\"footer\" class=\"dialog-footer\">\n          <el-button @click=\"editdialogVisible = false\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"editUserInfo\">确 定</el-button>\n        </span>\n      </el-dialog>\n    </el-card>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    // 添加手机号的验证规则\n    var checkPhone = (rule, value, cb) => {\n      // 验证手机号的正则表达式\n      // const regPhone = /^(0|86|17951)?(13[0-9]|15[0123456789]|17[678]|18[0-9]|14[57])[0-9]{8}$/\n      const regPhone = /^[1][3,4,5,7,8][0-9]{9}$/;\n      if (regPhone.test(value)) {\n        return cb();\n      }\n      cb(new Error(\"请输入合法的手机号\"));\n    };\n    return {\n      userlist: [],\n      queryInfo: {\n        // 搜索关键字\n        query: \"\",\n        // 当前页数\n        pagenum: 1,\n        // 当前页每页显示多少条数据\n        pagesize: 7\n      },\n      // 总页数\n      total: 7,\n      // 控制添加用户对话框的显示与隐藏\n      addDialogVisible: false,\n      // 控制编辑用户对话框的显示与隐藏\n      editdialogVisible: false,\n      // 添加用户的表单数据\n      addForm: {\n        userName: \"\",\n        sex: \"\",\n        telephone: \"\",\n        role: \"\"\n      },\n      // 添加表单的验证规则对象\n      addFormRules: {\n        userName: [\n          { required: true, message: \"请输入姓名\", trigger: \"blur\" },\n          { min: 3, max: 10, message: \"长度在 3 到 10 个字符\", trigger: \"blur\" }\n        ],\n        sex: [{ required: true, message: \"请选择性别\", trigger: \"blur\" }],\n        telephone: [\n          { required: true, message: \"请输入联系电话\", trigger: \"blur\" },\n          { validator: checkPhone, trigger: \"blur\" }\n        ],\n        role: [{ required: true, message: \"请选择用户角色\", trigger: \"blur\" }]\n      },\n      // 修改用户的表单数据\n      editForm: {\n        id: \"\",\n        name: \"\",\n        tel: \"\",\n        roler: \"\"\n      },\n      // 修改用户的表单验证规则对象\n      editFormRules: {\n        userName: [\n          { required: true, message: \"请输入姓名\", trigger: \"blur\" },\n          { min: 3, max: 10, message: \"长度在 3 到 10 个字符\", trigger: \"blur\" }\n        ],\n        telephone: [\n          { required: true, message: \"请输入联系电话\", trigger: \"blur\" },\n          { validator: checkPhone, trigger: \"blur\" }\n        ],\n        role: [{ required: true, message: \"请选择用户角色\", trigger: \"blur\" }]\n      },\n      // 控制分配角色对话框的显示与隐藏\n      setRoleDialogVisible: false,\n      // 需要被分配角色的用户信息\n      userInfo: {},\n      // 已选中角色的id值\n      selectedRoleId:''\n    };\n  },\n  created() {\n    this.oneQuest();\n  },\n  methods: {\n    // 格式化 table 表格数据\n    formatRole(row){\n      return row.roler=='0'?'超级管理员':'普通管理员'\n    },\n    // 封装页面加载请求函数\n    oneQuest() {\n      var _this = this;\n      this.$http\n        .post(\"http://localhost:3000/yhqx/search\", this.queryInfo)\n        .then(function(response) {\n          console.log(response.data);\n          if (response.data.code == 200) {\n            _this.userlist = response.data.data;\n            _this.total = response.data.total;\n          }\n        });\n    },\n    // 监听pageSize改变的事件\n    handleSizeChange(newSize) {\n      console.log(newSize);\n      this.queryInfo.pagesize = newSize;\n      this.oneQuest();\n    },\n    // 监听页码值改变的事件\n    handleCurrentChange(newPage) {\n      console.log(newPage);\n      this.queryInfo.pagenum = newPage;\n      this.oneQuest();\n    },\n    // 监听 switch开关状态的改变\n    userStateChanged(userInfo) {\n      console.log(userInfo);\n      // 发起请求\n    },\n    // 搜索按钮\n    search(user) {\n      console.log(user);\n      // 此处不应该这样写，应该发送请求获取后台数据在渲染表格\n      this.oneQuest()\n    },\n    // 监听添加用户对话框关闭事件\n    addDialogClosed() {\n      this.$refs.addFormRef.resetFields();\n    },\n    // 点击确定按钮，添加新用户\n    addUser() {\n      var _this = this;\n      this.$refs.addFormRef.validate(valid => {\n        console.log(valid);\n        if (!valid) return;\n        // 如果预校验成功则发起添加用户请求\n        this.$http\n        .post(\"http://localhost:3000/yhqx/add\", this.addForm)\n        .then(function(response) {\n          console.log(response.data);\n          if (response.data.code == 200) {\n            _this.$notify({\n                title: \"成功\",\n                message: \"添加用户成功\",\n                type: \"success\"\n              });\n           _this.oneQuest();\n           _this.addDialogVisible  = false\n          }\n        });\n        \n      });\n    },\n    // 展示编辑用户的对话框\n    showEditDialog(user) {\n      this.editdialogVisible = true;\n      console.log(user);\n      // 此处不应该这样渲染，应该根据用户id发起请求，得到用户信息后再渲染\n      this.editForm.name = user.name;\n      this.editForm.tel = user.tel;\n      this.editForm.roler = user.roler;\n      this.editForm.id = user.id;\n      // 根据用户id发起请求，得到用户信息\n    },\n    // 监听修改用户对话框关闭事件\n    editDialogClosed() {\n      this.$refs.editFormRef.resetFields();\n    },\n    // 点击修改用户信息对话框的确定按钮，修改信息并提交\n    editUserInfo() {\n      var _this = this;\n      this.$refs.editFormRef.validate(valid => {\n        console.log(valid);\n        if (!valid) return;\n        // 如果预校验成功则发起修改用户信息的请求\n        this.$http\n        .post(\"http://localhost:3000/yhqx/edit\", this.editForm)\n        .then(function(response) {\n          console.log(response.data);\n          if (response.data.code == 200) {\n            _this.$notify({\n                title: \"成功\",\n                message: \"修改成功\",\n                type: \"success\"\n              });\n           _this.oneQuest();\n           _this.editdialogVisible  = false\n          }else if(response.data.code == 0){\n             _this.$notify({\n                title: \"失败\",\n                message: \"修改失败\",\n                type: \"error\"\n              });\n          }\n        })\n      });\n    },\n    // 根据用户id删除用户\n    async removeUserById(id) {\n      var _this = this;\n      // 弹框询问用户是否删除数据\n      const cofirmResult = await this.$confirm(\n        \"此操作将永久删除该用户, 是否继续?\",\n        \"提示\",\n        {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        }\n      ).catch(err => err);\n      // 如果用户确认删除，则返回字符串 confirm\n      // 如果取消删除，则返回字符串 cancel\n      // console.log(cofirmResult)\n      if (cofirmResult !== \"confirm\") {\n        return this.$message({\n          showClose: true,\n          message: \"已取消删除\",\n          type: \"info\"\n        });\n      }\n      this.$http\n        .post(\"http://localhost:3000/yhqx/del\", {id:id})\n        .then(function(response) {\n          console.log(response.data);\n          if (response.data.code == 200) {\n            _this.$notify({\n                title: \"成功\",\n                message: \"删除成功\",\n                type: \"success\"\n              });\n           _this.oneQuest();\n          }else if(response.data.code == 0){\n             _this.$notify({\n                title: \"失败\",\n                message: \"删除失败\",\n                type: \"error\"\n              });\n          }\n        })\n      console.log(\"确认了删除\");\n    },\n    // 展示分配角色的对话框\n    setRole(userInfo) {\n      this.userInfo = userInfo;\n      this.setRoleDialogVisible = true;\n    },\n    // 监听分配角色对话框的关闭事件\n    setRoleDialogClosed(){\n      this.selectedRoleId = ''\n    }\n  }\n};\n</script>\n\n<style lang=\"css\" scoped>\n.marginTop{\n  margin-top: 15px;\n}\n#cz{\n  display: flex;\n  justify-content: space-around;\n}\n</style>"
        }
    ]
}